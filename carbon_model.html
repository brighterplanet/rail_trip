<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>carbon_model.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1667526-20']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</head>

<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>carbon_model.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        <p>Copyright Â© 2010 Brighter Planet.
See LICENSE for details.
Contact Brighter Planet for dual-license arrangements.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-Rail_trip_carbon_model'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Rail_trip_carbon_model">&#182;</a>
        </div>
        <h1>Rail trip carbon model</h1>

<p>This model is used by <a href="http://brighterplanet.com">Brighter Planet</a>&rsquo;s carbon emission <a href="http://carbon.brighterplanet.com">web service</a> to estimate the <strong>greenhouse gas emissions of passenger rail travel</strong>.</p>

<h4>Calculations</h4>

<p>The final estimate is the result of the <strong>calculations</strong> detailed below. These calculations are performed in reverse order, starting with the last calculation listed and finishing with the emission calculation. Each calculation is named according to the <code>value</code> it returns.</p>

<h4>Timeframe and date</h4>

<p>The model estimates the emissions that occur during a particular <code>timeframe</code>. To do this it needs to know the trip&rsquo;s <code>date</code>. For example, if the <code>timeframe</code> is January 2010, a trip that occurred on January 11, 2010 will have emissions but a trip that occurred on Febraury 1, 2010 will not.</p>

<h4>Methods</h4>

<p>To accomodate varying client input, each calculation may have one or more <strong>methods</strong>. These are listed under each calculation in order from most to least preferred. Each method is named according to the <code>values</code> it requires (&lsquo;default&rsquo; methods do not require any values). Methods are ignored if any of the values they require are unvailable. Calculations are ignored if all of their methods are unavailable.</p>

<h4>Standard compliance</h4>

<p>Each method lists any established calculation standards with which it <strong>complies</strong>. When compliance with a standard is requested, all methods that do not comply with that standard are ignored. This means that any values a particular method requires will have been calculated using a compliant method or will be unavailable.</p>

<h4>Collaboration</h4>

<p>Contributions to this carbon model are actively encouraged and warmly welcomed. This library includes a comprehensive test suite to ensure that your changes do not cause regressions. All changes should include test coverage for new functionality. Please see <a href="https://github.com/brighterplanet/sniff#readme">sniff</a>, our emitter testing framework, for more information.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">module</span> <span class="nn">BrighterPlanet</span>
  <span class="k">module</span> <span class="nn">RailTrip</span>
    <span class="k">module</span> <span class="nn">CarbonModel</span>
      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">base</span><span class="o">.</span><span class="n">decide</span> <span class="ss">:emission</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="ss">:characteristics</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Emission_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Emission_calculation">&#182;</a>
        </div>
        <h2>Emission calculation</h2>

<p>Returns the <code>emission</code> estimate (<em>kg CO<sub>2</sub>e</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:emission</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-From_fuel_and_passengers'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-From_fuel_and_passengers">&#182;</a>
        </div>
        <h3>From fuel and passengers</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from date, fuel, emission factors, and passengers&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:diesel_consumed</span><span class="p">,</span> <span class="ss">:diesel_emission_factor</span><span class="p">,</span> <span class="ss">:electricity_consumed</span><span class="p">,</span> <span class="ss">:electricity_emission_factor</span><span class="p">,</span> <span class="ss">:passengers</span><span class="p">,</span> <span class="ss">:date</span><span class="o">]</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-140641, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Date</span><span class="p">)</span> <span class="p">?</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">]</span> <span class="p">:</span> <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:date</span><span class="o">].</span><span class="n">to_s</span><span class="p">)</span></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>Checks whether the trip occurred during the <code>timeframe</code></p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="k">if</span> <span class="n">timeframe</span><span class="o">.</span><span class="n">include?</span> <span class="n">date</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <ul>
<li>Multiplies <code>diesel use</code> (<em>l</em>) by the <code>diesel emission factor</code> (<em>kg / l</em>) to give diesel emissions (<em>kg CO<sub>2</sub></em>)</li>
<li>Multiplies <code>electricity use</code> (<em>kWh</em>) by the <code>electricity emission factor</code> (<em>kg CO<sub>2</sub>e / kWh</em>) to give electricity emissions (<em>kg CO<sub>2</sub>e</em>)</li>
<li>Adds diesel and electricity emissions to give total emissions (<em>kg CO<sub>2</sub>e</em>)</li>
<li>Divides by passengers to give emissions per passenger (<em>kg CO<sub>2</sub>e</em>)</li>
</ul>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="p">(</span><span class="n">characteristics</span><span class="o">[</span><span class="ss">:diesel_consumed</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:diesel_emission_factor</span><span class="o">]</span> <span class="o">+</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_consumed</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_emission_factor</span><span class="o">]</span><span class="p">)</span> <span class="o">/</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:passengers</span><span class="o">]</span>
                <span class="k">else</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>If the trip did not occur during the <code>timeframe</code>, <code>emission</code> is zero</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                  <span class="mi">0</span>
                <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Diesel_emission_factor_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Diesel_emission_factor_calculation">&#182;</a>
        </div>
        <h2>Diesel emission factor calculation</h2>

<p>Returns the <code>diesel emission factor</code> (<em>kg CO<sub>2</sub>e / l</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:diesel_emission_factor</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Default_diesel_emission_factor'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Default_diesel_emission_factor">&#182;</a>
        </div>
        <h3>Default diesel emission factor</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14064-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>Looks up <a href="http://data.brighterplanet.com/fuels">Distillate Fuel Oil No. 2</a>&rsquo;s <code>co2 emission factor</code> (<em>kg / l</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="n">diesel</span> <span class="o">=</span> <span class="no">Fuel</span><span class="o">.</span><span class="n">find_by_name</span> <span class="s2">&quot;Distillate Fuel Oil No. 2&quot;</span>
              <span class="n">diesel</span><span class="o">.</span><span class="n">co2_emission_factor</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Electricity_emission_factor_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Electricity_emission_factor_calculation">&#182;</a>
        </div>
        <h2>Electricity emission factor calculation</h2>

<p>Returns the <code>electricity emission factor</code> (<em>kg CO<sub>2</sub>e / kWh</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:electricity_emission_factor</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Default_electricity_emission_factor'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Default_electricity_emission_factor">&#182;</a>
        </div>
        <h3>Default electricity emission factor</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14064-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>Looks up the <a href="http://data.brighterplanet.com/egrid_subregions">U.S. Average</a> <code>electricity emission factor</code> (<em>kg CO<sub>2</sub>e / l</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">subregion</span> <span class="o">=</span> <span class="no">EgridSubregion</span><span class="o">.</span><span class="n">find_by_abbreviation</span> <span class="s2">&quot;US&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>Looks up the <a href="http://data.brighterplanet.com/egrid_regions">U.S. Average</a> grid region <code>loss factor</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">region</span> <span class="o">=</span> <span class="n">subregion</span><span class="o">.</span><span class="n">egrid_region</span></pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>Divides the <code>electricity emission factor</code> by (1 &ndash; <code>loss factor</code>) to account for transmission and distribution losses.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">emission_factor</span> <span class="o">=</span> <span class="n">subregion</span><span class="o">.</span><span class="n">electricity_emission_factor</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">region</span><span class="o">.</span><span class="n">loss_factor</span><span class="p">)</span>
                <span class="n">emission_factor</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Diesel_consumed_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Diesel_consumed_calculation">&#182;</a>
        </div>
        <h2>Diesel consumed calculation</h2>

<p>Returns the <code>diesel use</code> (<em>l</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:diesel_consumed</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-From_distance_and_diesel_intensity'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-From_distance_and_diesel_intensity">&#182;</a>
        </div>
        <h3>From distance and diesel intensity</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance and diesel intensity&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance</span><span class="p">,</span> <span class="ss">:diesel_intensity</span><span class="o">]</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-140641, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-22'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-22">&#182;</a>
        </div>
        <p>Multiplies <code>distance</code> (<em>km</em>) by <code>diesel intensity</code> (<em>l / km</em>) to give <em>l</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:diesel_intensity</span><span class="o">]</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Electricity_consumed_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Electricity_consumed_calculation">&#182;</a>
        </div>
        <h2>Electricity consumed calculation</h2>

<p>Returns the <code>electricity use</code> (<em>kWh</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:electricity_consumed</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-From_distance_and_electricity_intensity'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-From_distance_and_electricity_intensity">&#182;</a>
        </div>
        <h3>From distance and electricity intensity</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance and electricity intensity&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:distance</span><span class="p">,</span> <span class="ss">:electricity_intensity</span><span class="o">]</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-25'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-25">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-140641, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-26'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-26">&#182;</a>
        </div>
        <p>Multiplies <code>distance</code> (<em>km</em>) by <code>electricity intensity</code> (<em>kWh / km</em>) to give <em>kWh</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance</span><span class="o">]</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:electricity_intensity</span><span class="o">]</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Distance_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_calculation">&#182;</a>
        </div>
        <h2>Distance calculation</h2>

<p>Returns the <code>distance</code> traveled (<em>km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:distance</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Distance_from_distance_estimate'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_from_distance_estimate">&#182;</a>
        </div>
        <h3>Distance from distance estimate</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from distance estimate&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:distance_estimate</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-29'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-29">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-140641, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-30'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-30">&#182;</a>
        </div>
        <p>Uses the <code>distance estimate</code> (<em>km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:distance_estimate</span><span class="o">]</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-Distance_from_duration_and_speed'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_from_duration_and_speed">&#182;</a>
        </div>
        <h3>Distance from duration and speed</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from duration and speed&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:duration</span><span class="p">,</span> <span class="ss">:speed</span><span class="o">]</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-32'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-32">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-140641, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-33'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-33">&#182;</a>
        </div>
        <p>Multiplies the <code>duration</code> (<em>seconds</em>) (converted to hours) by the <code>speed</code> (<em>km / hour</em>) to give <em>km</em>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:duration</span><span class="o">]</span> <span class="o">/</span> <span class="mi">3600</span><span class="o">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">characteristics</span><span class="o">[</span><span class="ss">:speed</span><span class="o">]</span>
            <span class="k">end</span>
            </pre></div>
      </td>
    </tr>
    <tr id='section-Distance_from_rail_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_from_rail_class">&#182;</a>
        </div>
        <h3>Distance from rail class</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from rail class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:rail_class</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-35'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-35">&#182;</a>
        </div>
        <p>Looks up the <a href="http://data.brighterplanet.com/rail_classes">rail class</a> <code>distance</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="n">characteristics</span><span class="o">[</span><span class="ss">:rail_class</span><span class="o">].</span><span class="n">distance</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Distance_estimate_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Distance_estimate_calculation">&#182;</a>
        </div>
        <h2>Distance estimate calculation</h2>

<p>Returns the trip&rsquo;s <code>distance estimate</code> (<em>km</em>)</p>

<h3>Distance estimate from client input</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the client-input <code>distance estimate</code> (<em>km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          </pre></div>
      </td>
    </tr>
    <tr id='section-Duration_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Duration_calculation">&#182;</a>
        </div>
        <h2>Duration calculation</h2>

<p>Returns the trip&rsquo;s <code>duration</code> (<em>seconds</em>).</p>

<h3>Duration from client input</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the client-input <code>duration</code> (<em>seconds</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          </pre></div>
      </td>
    </tr>
    <tr id='section-Diesel_intensity_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Diesel_intensity_calculation">&#182;</a>
        </div>
        <h2>Diesel intensity calculation</h2>

<p>Returns the <code>diesel intensity</code> (<em>l / km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:diesel_intensity</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Diesel_intensity_from_rail_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Diesel_intensity_from_rail_class">&#182;</a>
        </div>
        <h3>Diesel intensity from rail class</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from rail class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:rail_class</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-40'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-40">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-140641, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-41'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-41">&#182;</a>
        </div>
        <p>Looks up the <a href="http://data.brighterplanet.com/rail_classes">rail class</a> <code>diesel intensity</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:rail_class</span><span class="o">].</span><span class="n">diesel_intensity</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Electricity_intensity_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Electricity_intensity_calculation">&#182;</a>
        </div>
        <h2>Electricity intensity calculation</h2>

<p>Returns the <code>electricity intensity</code> (<em>kWh / km</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:electricity_intensity</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Electricity_intensity_from_rail_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Electricity_intensity_from_rail_class">&#182;</a>
        </div>
        <h3>Electricity intensity from rail class</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from rail class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:rail_class</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-44'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-44">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-140641, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-45'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-45">&#182;</a>
        </div>
        <p>Looks up the <a href="http://data.brighterplanet.com/rail_classes">rail class</a> <code>electricity intensity</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:rail_class</span><span class="o">].</span><span class="n">electricity_intensity</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Speed_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Speed_calculation">&#182;</a>
        </div>
        <h2>Speed calculation</h2>

<p>Returns the average <code>speed</code> (<em>km / hour</em>).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:speed</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Speed_from_rail_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Speed_from_rail_class">&#182;</a>
        </div>
        <h3>Speed from rail class</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from rail class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:rail_class</span><span class="p">,</span> </pre></div>
      </td>
    </tr>
    <tr id='section-48'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-48">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-140641, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-49'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-49">&#182;</a>
        </div>
        <p>Looks up the <a href="http://data.brighterplanet.com/rail_classes">rail class</a> <code>speed</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:rail_class</span><span class="o">].</span><span class="n">speed</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Passengers_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Passengers_calculation">&#182;</a>
        </div>
        <h2>Passengers calculation</h2>

<p>Returns the total number of <code>passengers</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:passengers</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Passengers_from_rail_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Passengers_from_rail_class">&#182;</a>
        </div>
        <h3>Passengers from rail class</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from rail class&#39;</span><span class="p">,</span> <span class="ss">:needs</span> <span class="o">=&gt;</span> <span class="ss">:rail_class</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-52'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-52">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-140641, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span>  <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-53'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-53">&#182;</a>
        </div>
        <p>Looks up the <a href="http://data.brighterplanet.com/rail_classes">rail class</a> <code>passengers</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">characteristics</span><span class="o">[</span><span class="ss">:rail_class</span><span class="o">].</span><span class="n">passengers</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Rail_class_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Rail_class_calculation">&#182;</a>
        </div>
        <h2>Rail class calculation</h2>

<p>Returns the <a href="http://data.brighterplanet.com/rail_classes">rail class</a>. This is the type of rail the trip used.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:rail_class</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Rail_class_from_client_input'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Rail_class_from_client_input">&#182;</a>
        </div>
        <h3>Rail class from client input</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the client-input <a href="http://data.brighterplanet.com/rail_classes">rail class</a>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-Default_rail_class'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Default_rail_class">&#182;</a>
        </div>
        <h3>Default rail class</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> </pre></div>
      </td>
    </tr>
    <tr id='section-57'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-57">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO 14064-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-58'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-58">&#182;</a>
        </div>
        <p>Uses an artificial <a href="http://data.brighterplanet.com/rail_classes">rail class</a> representing the U.S. average.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="no">RailClass</span><span class="o">.</span><span class="n">find_by_name</span> <span class="s2">&quot;US average&quot;</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Date_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Date_calculation">&#182;</a>
        </div>
        <h2>Date calculation</h2>

<p>Returns the <code>date</code> on which the trip occurred.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>          <span class="n">committee</span> <span class="ss">:date</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-Date_from_client_input'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Date_from_client_input">&#182;</a>
        </div>
        <h3>Date from client input</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the client-input <code>date</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-Date_from_timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Date_from_timeframe">&#182;</a>
        </div>
        <h3>Date from timeframe</h3>
      </td>
      <td class=code>
        <div class='highlight'><pre>            <span class="n">quorum</span> <span class="s1">&#39;from timeframe&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-62'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-62">&#182;</a>
        </div>
        <p><strong>Complies:</strong> GHG Protocol Scope 3, ISO-14064-1, Climate Registry Protocol</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>              <span class="ss">:complies</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:ghg_protocol_scope_3</span><span class="p">,</span> <span class="ss">:iso</span><span class="p">,</span> <span class="ss">:tcr</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">characteristics</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-63'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-63">&#182;</a>
        </div>
        <p>Assumes the trip occurred on the first day of the <code>timeframe</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>                <span class="n">timeframe</span><span class="o">.</span><span class="n">from</span>
            <span class="k">end</span>
          <span class="k">end</span>
          </pre></div>
      </td>
    </tr>
    <tr id='section-Timeframe_calculation'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Timeframe_calculation">&#182;</a>
        </div>
        <h2>Timeframe calculation</h2>

<p>Returns the <code>timeframe</code>.
This is the period during which to calculate emissions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-Timeframe_from_client_input'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Timeframe_from_client_input">&#182;</a>
        </div>
        <h3>Timeframe from client input</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the client-input <code>timeframe</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>            </pre></div>
      </td>
    </tr>
    <tr id='section-Default_timeframe'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Default_timeframe">&#182;</a>
        </div>
        <h3>Default timeframe</h3>

<p><strong>Complies:</strong> All</p>

<p>Uses the current calendar year.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
